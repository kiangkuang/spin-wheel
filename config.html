<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wheel Configuration</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
  </head>

  <body>
    <div id="app" class="container py-4">
      <h1>Wheel Configuration</h1>

      <div class="mb-4">
        <div
          v-for="(item, index) in items"
          :key="index"
          class="row g-2 pb-2 my-1 align-items-center rounded"
          :class="{ dragging: draggingIndex === index }"
        >
          <div class="col-1">
            <div
              class="drag-handle"
              draggable="true"
              @dragstart="dragStart($event, index)"
              @dragover.prevent
              @dragenter.prevent="dragEnter($event, index)"
              @dragend="dragEnd"
              @touchstart="touchStart($event, index)"
              @touchmove.prevent="touchMove($event)"
              @touchend="touchEnd"
            >
              ⋮⋮
            </div>
          </div>
          <div class="col-11 col-md">
            <input
              v-model.trim="item.label"
              class="form-control"
              placeholder="Label"
            />
          </div>
          <div class="col offset-1 col-md-2 offset-md-0">
            <input
              v-model.trim="item.backgroundColor"
              class="form-control"
              placeholder="Color"
              list="colorOptions"
              :style="{
                backgroundColor: item.backgroundColor,
                color: getContrastColor(item.backgroundColor),
              }"
            />
            <datalist id="colorOptions">
              <option value="red"></option>
              <option value="blue"></option>
              <option value="green"></option>
              <option value="yellow"></option>
              <option value="orange"></option>
              <option value="purple"></option>
              <option value="pink"></option>
              <option value="navy"></option>
              <option value="teal"></option>
              <option value="brown"></option>
            </datalist>
          </div>
          <div class="col-5 col-md-3">
            <div class="input-group">
              <input
                v-model.number="item.weight"
                type="number"
                class="form-control"
                min="1"
                placeholder="Weight"
              />
              <span class="input-group-text text-secondary">
                {{ Math.round(item.weight / sumWeights * 1000) / 10 }}%
              </span>
            </div>
          </div>
          <div class="col-auto">
            <button @click="removeItem(index)" class="btn btn-danger w-100">
              ×
            </button>
          </div>
        </div>

        <button @click="addItem" class="btn btn-primary">Add Item</button>
      </div>

      <div>
        <p class="text-muted mb-2">Recommended steps:</p>
        <ol class="text-muted small mb-3">
          <li>Open the wheel to verify your configuration</li>
          <li>
            Copy and use the URL directly
            <ul>
              <li>
                If the URL is too long, create a shorter link using
                <a href="https://tinyurl.com" target="_blank">TinyURL</a>
              </li>
            </ul>
          </li>
        </ol>

        <div class="d-flex gap-2">
          <a :href="wheelUrl" ref="wheelUrlElement" class="btn btn-secondary">
            1. Open Wheel
          </a>
          <button @click="copyUrl" class="btn btn-success">
            2. {{copyBtnText}}
          </button>
        </div>
      </div>
    </div>

    <script type="module">
      import {
        createApp,
        ref,
        computed,
      } from "https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js";
      import { useDraggableList } from "./js/composables/useDraggableList.js";
      import { useUrlManagement } from "./js/composables/useUrlManagement.js";
      import { useItems } from "./js/composables/useItems.js";
      import { getContrastColor } from "./js/utils.js";

      createApp({
        setup() {
          const { items, addItem, removeItem, sumWeights } = useItems();
          const { wheelUrl, wheelUrlElement, copyUrl, copyBtnText } =
            useUrlManagement(items);
          const {
            draggingIndex,
            dragStart,
            dragEnter,
            dragEnd,
            touchStart,
            touchMove,
            touchEnd,
          } = useDraggableList(items);

          return {
            items,
            addItem,
            removeItem,
            sumWeights,
            wheelUrl,
            wheelUrlElement,
            copyUrl,
            copyBtnText,
            draggingIndex,
            dragStart,
            dragEnter,
            dragEnd,
            touchStart,
            touchMove,
            touchEnd,
            getContrastColor,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
